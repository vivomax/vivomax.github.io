<!DOCTYPE html>
<html lang="zh-CN">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>安全访问网关</title>
   <style>
       body {
           font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
           margin: 0;
           padding: 0;
           background-color: #f5f5f5;
           color: #333;
           line-height: 1.6;
       }
       .container {
           max-width: 800px;
           margin: 50px auto;
           padding: 30px;
           background-color: #fff;
           border-radius: 8px;
           box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
           text-align: center;
       }
       .logo {
           width: 120px;
           height: 120px;
           margin-bottom: 20px;
           background-color: #07C160;
           border-radius: 50%;
           display: inline-flex;
           align-items: center;
           justify-content: center;
           color: white;
           font-size: 24px;
           font-weight: bold;
       }
       h1 {
           color: #07C160;
           margin-bottom: 20px;
       }
       .content-box {
           background-color: #f9f9f9;
           border-left: 4px solid #07C160;
           padding: 15px;
           margin: 20px 0;
           text-align: left;
       }
       .btn-container {
           display: flex;
           justify-content: center;
           gap: 20px;
           margin-top: 30px;
           flex-wrap: wrap;
       }
       .btn {
           padding: 12px 30px;
           border: none;
           border-radius: 4px;
           font-size: 16px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 500;
       }
       .btn-primary {
           background-color: #07C160;
           color: white;
       }
       .btn-primary:hover {
           background-color: #06AD56;
       }
       .btn-secondary {
           background-color: #f0f0f0;
           color: #333;
       }
       .btn-secondary:hover {
           background-color: #e0e0e0;
       }
       .hidden {
           display: none;
       }
       #iframe-container {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           border: none;
           z-index: 1000;
           background: white;
       }
       .notice {
           font-size: 14px;
           color: #666;
           margin-top: 30px;
           padding-top: 15px;
           border-top: 1px solid #eee;
       }
       .toast {
           position: fixed;
           top: 20px;
           left: 50%;
           transform: translateX(-50%);
           background-color: rgba(0, 0, 0, 0.7);
           color: white;
           padding: 10px 20px;
           border-radius: 4px;
           z-index: 1001;
           opacity: 0;
           transition: opacity 0.3s;
           pointer-events: none;
       }
       .show {
           opacity: 1;
       }
       @media (max-width: 600px) {
           .container {
               margin: 20px auto;
               padding: 20px;
           }
           .btn {
               padding: 10px 20px;
               width: 100%;
           }
           .btn-container {
               flex-direction: column;
               gap: 10px;
           }
       }
   </style>
</head>
<body>
   <div class="container" id="main-content">
       <div class="logo">安</div>
       <h1 id="page-title">安全访问网关</h1>
       
       <div class="content-box">
           <h3>社会主义核心价值观</h3>
           <p>富强、民主、文明、和谐、自由、平等、公正、法治、爱国、敬业、诚信、友善</p>
       </div>
       
       <div class="content-box">
           <h3>网络安全提示</h3>
           <p>根据国家相关法律法规和网络安全要求，您即将访问的外部链接需经过安全确认。请确保访问的网站内容合法合规，共同维护清朗网络空间。</p>
       </div>
       
       <div class="btn-container">
           <button class="btn btn-primary" id="continue-btn">继续访问</button>
           <button class="btn btn-secondary" id="copy-btn">复制链接</button>
       </div>
       
       <div class="notice">
           <p>本服务严格遵守国家法律法规，所有访问记录将依法保存</p>
       </div>
   </div>
   
   <iframe id="iframe-container" class="hidden"></iframe>
   
   <div class="toast" id="toast">链接已复制</div>
   
   <script>
       // 获取URL参数
       function getQueryParam(name) {
           const urlParams = new URLSearchParams(window.location.search);
           return urlParams.get(name);
       }
       
       // 解码URL
       function decodeUrl(url) {
           try {
               return decodeURIComponent(url);
           } catch (e) {
               return url;
           }
       }
       
       // 安全验证URL
       function validateUrl(url) {
           if (!url) return null;
           
           // 移除可能的XSS尝试
           url = url.replace(/[\<\>\"\']/g, '');
           
           // 验证URL格式
           try {
               const urlObj = new URL(url);
               // 允许http/https协议
               if (urlObj.protocol !== 'http:' && urlObj.protocol !== 'https:') {
                   return null;
               }
               return urlObj.toString();
           } catch (e) {
               return null;
           }
       }
       
       // 获取域名
       function getDomain(url) {
           try {
               const urlObj = new URL(url);
               return urlObj.hostname.replace('www.', '');
           } catch (e) {
               return url;
           }
       }
       
       // 复制文本到剪贴板
       function copyToClipboard(text) {
           return new Promise((resolve, reject) => {
               if (navigator.clipboard) {
                   navigator.clipboard.writeText(text).then(resolve).catch(reject);
               } else {
                   // 兼容旧版浏览器和移动端
                   const textarea = document.createElement('textarea');
                   textarea.value = text;
                   textarea.style.position = 'fixed';  // 防止滚动到页面底部
                   document.body.appendChild(textarea);
                   textarea.select();
                   
                   try {
                       const successful = document.execCommand('copy');
                       document.body.removeChild(textarea);
                       successful ? resolve() : reject();
                   } catch (err) {
                       document.body.removeChild(textarea);
                       reject(err);
                   }
               }
           });
       }
       
       // 显示Toast提示
       function showToast(message) {
           const toast = document.getElementById('toast');
           toast.textContent = message;
           toast.classList.add('show');
           setTimeout(() => {
               toast.classList.remove('show');
           }, 2000);
       }
       
       // 主逻辑
       document.addEventListener('DOMContentLoaded', function() {
           const targetUrl = validateUrl(decodeUrl(getQueryParam('url')));
           const continueBtn = document.getElementById('continue-btn');
           const copyBtn = document.getElementById('copy-btn');
           const iframe = document.getElementById('iframe-container');
           const mainContent = document.getElementById('main-content');
           const pageTitle = document.getElementById('page-title');
           
           if (!targetUrl) {
               continueBtn.disabled = true;
               copyBtn.disabled = true;
               showToast('无效的URL参数，请提供正确的网址');
               return;
           }
           
           // 设置页面标题为域名
           const domain = getDomain(targetUrl);
           document.title = `${domain} - 安全访问`;
           pageTitle.textContent = `访问 ${domain}`;
           
           // 继续访问按钮
           continueBtn.addEventListener('click', function() {
               mainContent.classList.add('hidden');
               iframe.classList.remove('hidden');
               iframe.src = targetUrl;
           });
           
           // 复制链接按钮
           copyBtn.addEventListener('click', function() {
               copyToClipboard(targetUrl)
                   .then(() => showToast('链接已复制'))
                   .catch(() => showToast('复制失败，请手动复制'));
           });
           
           // 防止被检测为iframe
           if (window.self !== window.top) {
               window.top.location = window.self.location;
           }
       });
   </script>
</body>
</html>
